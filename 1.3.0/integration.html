<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sbepp: Integration into your project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="version_selector_handler.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">sbepp<span id="projectnumber"/>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('integration.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Integration into your project</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md4">Compiling schema on-the-fly</a><ul><li class="level2"><a href="#autotoc_md6">CMake helpers</a></li>
<li class="level2"><a href="#autotoc_md9">Manual schema compilation</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md11">Using pre-compiled schema</a></li>
<li class="level1"><a href="#versioning">Versioning and compatibility</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__2home_2runner_2work_2sbepp_2sbepp_2doc_2integration"></a></p>
<p>After schema compilation, the only thing you need to use it is to include generated files into your project and link to <code>sbepp::sbepp</code> CMake target.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md4"></a>
Compiling schema on-the-fly</h1>
<p>The most simple way is to compile schema on-the-fly, that is, to store only schema XML in your source tree and generate C++ headers from it during the build process.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md6"></a>
CMake helpers</h2>
<p><code>sbepp</code> provides a couple of helpers to make on-the-fly schema compilation as easy as possible.</p>
<p><code>sbeppc_compile_schema</code> - creates <code>INTERFACE</code> library that compiles SBE schema using <code>sbeppc</code>. <br  />
 Parameters:</p><ul>
<li><code>SCHEMA_FILE</code>, the path to schema XML file.</li>
<li><code>TARGET_NAME</code>, the name of the generated <code>INTERFACE</code> library. Same target can be used to compile multiple schemas.</li>
<li><code>OUTPUT_DIR</code>, optional, the directory in which <code>sbeppc</code> will generate headers. Defaults to <code>${CMAKE_BINARY_DIR}/sbeppc_generated</code>.</li>
<li><code>SCHEMA_NAME</code>, optional, overrides schema name from XML.</li>
<li><code>SBEPPC_PATH</code>, optional, the path to <code>sbeppc</code> binary, uses <code>sbepp::sbeppc</code> CMake target by default.</li>
</ul>
<p>This function creates custom target using <code>sbeppc_make_schema_target</code> (described below) and then creates <code>INTERFACE</code> library on top of it. This library carries all necessary dependencies and settings so there's a minimal amount of work left to user:</p>
<div class="fragment"><div class="line">sbeppc_compile_schema(</div>
<div class="line">    TARGET_NAME compiled_schemas</div>
<div class="line">    SCHEMA_FILE &quot;schema1.xml&quot;</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">sbeppc_compile_schema(</div>
<div class="line">    # note that we can use the same target name for many schemas</div>
<div class="line">    TARGET_NAME compiled_schemas</div>
<div class="line">    SCHEMA_FILE &quot;schema2.xml&quot;</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">add_executable(exe)</div>
<div class="line"># generated target carries all necessary dependencies, just link to it</div>
<div class="line">target_link_libraries(exe PRIVATE compiled_schemas)</div>
</div><!-- fragment --><hr  />
<p><code>sbeppc_make_schema_target</code> - creates a custom target that compiles SBE schema using <code>sbeppc</code>. <br  />
 Parameters:</p><ul>
<li><code>SCHEMA_FILE</code>, the path to schema XML file.</li>
<li><code>TARGET_NAME</code>, the name of generated custom target. Same target can be used to compile multiple schemas.</li>
<li><code>OUTPUT_DIR</code>, the directory in which <code>sbeppc</code> will generate headers.</li>
<li><code>SCHEMA_NAME</code>, optional, overrides schema name from XML.</li>
<li><code>SBEPPC_PATH</code>, optional, the path to <code>sbeppc</code> binary, uses <code>sbepp::sbeppc</code> CMake target by default.</li>
</ul>
<p>This is a lower-level function than <code>sbeppc_compile_schema</code>. It only creates a custom command and a custom target to compile the schema leaving the rest of work up to user. When <code>SCHEMA_NAME</code> is not provided, it also creates a special empty anchor file with a name like <code>&lt;HASH&gt;.anchor</code> for a schema. This file is indirectly included into all generated headers and required for CMake and underlying build systems to establish correct dependency graph and enforce automatic recompilation of consumers of this target when either schema XML or <code>sbeppc</code> itself changes.</p>
<p>Example:</p>
<div class="fragment"><div class="line">sbeppc_make_schema_target(</div>
<div class="line">    SCHEMA_FILE &quot;schema1.xml&quot;</div>
<div class="line">    TARGET_NAME compiled_schemas</div>
<div class="line">    OUTPUT_DIR ${CMAKE_CURRENT_BINARY_DIR}</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">sbeppc_make_schema_target(</div>
<div class="line">    SCHEMA_FILE &quot;schema2.xml&quot;</div>
<div class="line">    TARGET_NAME compiled_schemas</div>
<div class="line">    OUTPUT_DIR ${CMAKE_CURRENT_BINARY_DIR}</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">add_executable(exe)</div>
<div class="line">add_dependencies(exe compiled_schemas)</div>
<div class="line">target_include_directories(exe SYSTEM PRIVATE ${CMAKE_CURRENT_BINARY_DIR})</div>
<div class="line">target_link_libraries(exe PRIVATE sbepp::sbepp)</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md9"></a>
Manual schema compilation</h2>
<p>Here's an example of how to implement the above functionality by-hand:</p>
<div class="fragment"><div class="line">set(schema &quot;schema_name&quot;)</div>
<div class="line">set(schema_path &quot;${CMAKE_CURRENT_LIST_DIR}/schemas/${schema}.xml&quot;)</div>
<div class="line"> </div>
<div class="line"># mention one of the output files</div>
<div class="line">set(output_file &quot;${CMAKE_CURRENT_BINARY_DIR}/${schema}/${schema}.hpp&quot;)</div>
<div class="line"> </div>
<div class="line"># add a command which compiles the schema</div>
<div class="line">add_custom_command(</div>
<div class="line">    OUTPUT ${output_file}</div>
<div class="line">    COMMAND $&lt;TARGET_FILE:sbepp::sbeppc&gt; &quot;${schema_path}&quot;</div>
<div class="line">    DEPENDS &quot;${schema_path}&quot;</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># add a custom target which depends on the above</div>
<div class="line">add_custom_target(compile_schema</div>
<div class="line">    DEPENDS ${output_file}</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># add it to dependencies of your target</div>
<div class="line">add_executable(my_project)</div>
<div class="line">add_dependencies(my_project compile_schema)</div>
<div class="line"> </div>
<div class="line"># add CMAKE_CURRENT_BINARY_DIR to be able to access generated headers</div>
<div class="line">target_include_directories(my_project</div>
<div class="line">    SYSTEM PRIVATE                      # Note `SYSTEM`</div>
<div class="line">    ${CMAKE_CURRENT_BINARY_DIR}</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># link to sbepp::sbepp</div>
<div class="line">target_link_libraries(my_project</div>
<div class="line">    PRIVATE</div>
<div class="line">    sbepp::sbepp</div>
<div class="line">)</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md11"></a>
Using pre-compiled schema</h1>
<p>Another approach is to use pre-compiled schema headers, that is, generate headers once and store them in the source tree. This might be useful when it's not desired/possible to build/install <code>sbeppc</code> in developer environment (e.g. if C++17 required for <code>sbeppc</code> is not available). It requires building <code>sbeppc</code> once somewhere, generating schema headers using it and pushing them to the source tree to be used by others. In this case care should be taken to keep once-generated headers <a class="el" href="#versioning">compatible</a> with <code>sbepp</code> if it's installed automatically via some dependency management mechanism.</p>
<dl class="section note"><dt>Note</dt><dd>Check out <a class="el" href="installation.html#installation-cmake">SBEPP_BUILD_SBEPPC</a> and <a class="el" href="installation.html#installation-conan">with_sbeppc</a> options to see how to disable <code>sbeppc</code> building for such cases.</dd></dl>
<p>Also, since it's a third-party code, it's recommended to mark include path for generated headers as <code>SYSTEM</code> to hide potential warnings.</p>
<hr  />
<h1><a class="anchor" id="versioning"></a>
Versioning and compatibility</h1>
<p><code>sbepp</code> uses <a href="https://semver.org/">SemVer</a> that is defined in terms of <em>public API</em>, its users and its changes. <code>sbepp</code> defines public API as:</p><ul>
<li><code>sbepp::sbeppc</code> schema compiler</li>
<li>public parts of <code>sbepp::sbepp</code> supporting library</li>
<li>public parts of generated headers</li>
</ul>
<p>The most important consequence from this definition is that <b>whether a change is compatible/incompatible depends only on how it affects user's code, not the generated one.</b> In practice it means that headers generated by <code>sbepp::sbeppc</code> version <code>1.2.3</code> might not be compatible with <code>sbepp::sbepp</code> version <code>1.3.0</code> and even with <code>1.2.4</code>. Such incompatibility requires schema recompilation but not the user's code change (only MAJOR update will require that).</p>
<p>To summarize, the advised strategy is to use the same version of <code>sbepp::sbeppc</code> and <code>sbepp::sbepp</code> to generate and use headers. Types from the <code>detail</code> namespace should never be mentioned/used explicitly, they can be affected even by the PATCH version change. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
